<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>WebSocket Demo</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.5.0/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <style>
        #message-container {
            border: 1px solid #ccc;
            height: 300px;
            overflow-y: scroll;
            padding: 10px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
<h1>WebSocket 通信演示</h1>

<div id="message-container"></div>

<input type="text" id="message-input" placeholder="输入消息...">
<button onclick="sendMessage()">发送</button>

<script>
    // 建立连接
    const socket = new SockJS('/ws');
    const stompClient = Stomp.over(socket);

    // 连接成功回调
    stompClient.connect({}, function(frame) {
        console.log('Connected: ' + frame);

        // 订阅/topic/messages频道
        stompClient.subscribe('/topic/messages', function(response) {
            const message = JSON.parse(response.body);
            showMessage(message.sender + ": " + message.content);
        });
    });

    // 发送消息
    function sendMessage() {
        const input = document.getElementById('message-input');
        const message = input.value;

        if(message.trim()) {
            // 发送到/app/send
            stompClient.send("/app/send", {}, message);
            input.value = '';
        }
    }

    // 显示消息
    function showMessage(message) {
        const container = document.getElementById('message-container');
        const p = document.createElement('p');
        p.textContent = message;
        container.appendChild(p);
        container.scrollTop = container.scrollHeight;
    }
</script>
</body>
</html>